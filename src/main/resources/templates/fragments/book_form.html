<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>links</title>

    <link rel="stylesheet/less" type="text/css" href="../../static/less/style.less" data-th-href="@{/less/style.less}"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.7.2/less.min.js" data-th-src="@{/js/less.min.js}"
            type="text/javascript"></script>

</head>
<body>
<div data-th-fragment="book_form" class="block-book_form container">
    <!--/*@thymesVar id="discount" type="ca.tidygroup.model.Discount"*/-->
    <form id="discountForm" th:action="@{/applyActivationCode}" method="post" data-th-object="${discount}"></form>
    <!--/*@thymesVar id="booking" type="ca.tidygroup.dto.BookingForm"*/-->
    <form id="bookingForm" th:action="@{/book}" method="post" data-th-object="${booking}">
        <div class="row">
            <div class="col-md-9">

                <div class="form-group row">
                    <div class="col-md-6">
                        <select class="form-control" data-th-field="*{cleaningPlan}" form="bookingForm">
                            <!--/*@thymesVar id="allPlans" type="java.util.List<ca.tidygroup.model.CleaningPlan>"*/-->
                            <th:block th:each="plan : ${allPlans}">
                                <option data-th-id="${{plan}}" data-th-value="${{plan}}"
                                        data-th-text="${plan.name}"></option>
                            </th:block>
                        </select>
                    </div>
                </div>

                <div class="form-inline row">
                    <div class="form-group col-md-6">
                        <label class="control-label">Number of bedrooms</label>
                        <select class="form-control" data-th-field="*{numberOfRooms}" form="bookingForm">
                            <!--/*@thymesVar id="allBedrooms" type="java.util.List<java.lang.Integer>"*/-->
                            <th:block th:each="numberOfBedroom : ${allBedrooms}">
                                <option data-th-id="${{numberOfBedroom}}" data-th-value="${{numberOfBedroom}}"
                                        data-th-text="${numberOfBedroom}"></option>
                            </th:block>
                        </select>
                        <span class="help-block" data-th-errors="*{numberOfRooms}">error</span>
                    </div>

                    <div class="form-group col-md-6">
                        <label class="control-label">Number of bathrooms</label>
                        <select class="form-control" data-th-field="*{numberOfBathrooms}" form="bookingForm">
                            <option value="1">1 bathroom</option>
                        </select>
                        <span class="help-block" data-th-errors="*{numberOfBathrooms}">error</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label">Extra services</label>
                    <table>
                        <!--/*@thymesVar id="allOptions" type="java.util.List<ca.tidygroup.model.CleaningOption>"*/-->
                        <th:block th:each="option: ${allOptions}">
                            <tr>
                                <td>
                                    <input type="checkbox" data-th-id="${{option}}" data-th-value="${{option}}"
                                           data-th-field="*{cleaningOptions}" th:attr="data-price=${option.price}"
                                           form="bookingForm"/>
                                    <br/>
                                </td>
                                <td th:text="${option.name}"><br/></td>
                                <td th:text="${option.price}"><br/></td>
                            </tr>
                        </th:block>
                    </table>
                </div>
                <div class="form-group">
                    <label class="control-label">Special request</label>
                    <input class="form-control" type="text" data-th-field="*{specialRequest}" form="bookingForm"/>
                    <span class="help-block" data-th-errors="*{specialRequest}">error</span>
                </div>
                <div th:class="row">
                    <div class="form-group col-md-10">
                        <label class="control-label ">Address</label>
                        <input class="form-control" type="text" data-th-field="*{address}" placeholder="Address"
                               form="bookingForm" required="required"/>
                        <span class="help-block" data-th-errors="*{address}">error</span>
                    </div>
                    <div class="form-group col-md-2">
                        <label class="control-label">Apt. Number</label>
                        <input class="form-control" type="text" data-th-field="*{aptNumber}" placeholder="Apt. Number"
                               form="bookingForm"/>
                        <span class="help-block" data-th-errors="*{aptNumber}">error</span>
                    </div>
                </div>
                <br/>
                <div class="form-inline row">
                    <div class="form-group col-md-6">
                        <label class="control-label col-md-4">First name</label>
                        <input class="form-control col-md-8" type="text" data-th-field="*{firstName}"
                               required="required" form="bookingForm" placeholder="First name"/>
                        <span class="help-block" data-th-errors="*{firstName}">error</span>
                    </div>

                    <div class="form-group col-md-6">
                        <label class="control-label col-md-4">Last name</label>
                        <input class="form-control col-md-8" type="text" data-th-field="*{lastName}" required="required"
                               placeholder="Last name" form="bookingForm"/>
                        <span class="help-block" data-th-errors="*{lastName}">error</span>
                    </div>
                </div>
                <br/>
                <div class="form-inline row">
                    <div class="form-group col-md-6">
                        <label class="control-label col-md-4">Email</label>
                        <input class="form-control col-md-8" type="email" data-th-field="*{email}" required="required"
                               placeholder="Email" form="bookingForm"/>
                        <span class="help-block" data-th-errors="*{email}">error</span>
                    </div>

                    <div class="form-group col-md-6">
                        <label class="control-label col-md-4">Phone</label>
                        <input class="form-control col-md-8" type="tel" data-th-field="*{phone}" required="required"
                               placeholder="Phone" form="bookingForm"/>
                        <span class="help-block" data-th-errors="*{phone}">error</span>
                    </div>
                </div>
                <br/>

                <div class="form-group row">
                    <div class="col-md-6" th:if="${booking.discount == null}">
                        <label class="control-label">Discount</label>
                        <input class="form-control" type="text" form="discountForm" data-th-field="${discount.code}"/>
                        <input class="form-control" type="submit" form="discountForm"/>
                        <span class="help-block" data-th-errors="${discount.code}">error</span>
                    </div>
                </div>

                <div class="form-inline row">
                    <div class="form-group col-md-6">
                        <label class="control-label">Date of cleaning</label>
                        <input class="form-control" type="text" data-th-field="*{cleaningDate}" form="bookingForm"/>
                        <span class="help-block" data-th-errors="*{cleaningDate}">error</span>
                    </div>

                    <div class="form-group col-md-6">
                        <label class="control-label">Time of cleaning</label>
                        <select class="form-control" data-th-field="*{cleaningTime}" form="bookingForm" required="required">
                            <!-- options populated by js -->
                        </select>
                        <span class="help-block" data-th-errors="*{cleaningTime}">error</span>
                    </div>
                </div>
                <br/>
                <input type="hidden" form="bookingForm" data-th-field="*{price}"/>
                <input class="form-control" type="submit" form="bookingForm"/>
            </div>
            <div class="col-md-3">
                <h4>BOOKING SUMMARY</h4>
                <div class="form-group row">
                    <label class="control-label col-md-6">SUB-TOTAL</label>
                    <span class="booking-price price col-md-6"></span>
                </div>
                <div class="form-group row">
                    <label class="control-label col-md-6 ">SALES TAX</label>
                    <span class="booking-price-tax price col-md-6"></span>
                </div>
                <div class="form-group row" th:if="${booking.discount != null}">
                    <label class="control-label col-md-6">DISCOUNT</label>
                    <span class="booking-discount price col-md-6" data-th-text="${booking.discount} + '%'"
                        th:attr="data-discount=${booking.discount}">0</span>
                    <input type="hidden" data-th-field="${booking.discount}" form="bookingForm"/>
                </div>
                <div class="form-group row">
                    <label class="control-label col-md-6">TOTAL</label>
                    <span class="booking-price-total price col-md-6"></span>
                </div>
            </div>
        </div>
    </form>

    <!--/*@thymesVar id="googleApiKey" type="java.lang.String"*/-->
    <script type="text/javascript"
            data-th-src="@{https://maps.googleapis.com/maps/api/js(key=${googleApiKey},libraries='places')}"></script>

    <!-- jQuery UI for calendar -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script type="text/javascript">
        /*<![CDATA[*/
        $(function () {
            // showing calendar
            $('#cleaningDate').datepicker({
                dateFormat: "yy-mm-dd"
            });

            $('#address').on('change', function() {
                $('input#address').parent('div.form-group').removeClass('has-error');
            });

            var autocomplete = new google.maps.places.Autocomplete((document.getElementById('address')),
                {types: ['address'], componentRestrictions: {country: 'ca'}});

            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                console.log(place.formatted_address);

                $.each(place.address_components, function (idx, item) {
                    if (item.types[0] === 'locality' && item.long_name !== 'Vancouver') {
                        $('input#address').parent('div.form-group').addClass('has-error');
                        alert("Sorry, we are not there yet!");
                    }
                });
            });
        });
        /*]]>*/
    </script>

    <script src="../../static/js/booking.js" data-th-src="@{/js/booking.js}" type="text/javascript"></script>
</div>

</body>
</html>